<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<title>動画アプリ</title>

<style>
*{box-sizing:border-box;margin:0;padding:0;font-family:sans-serif;}
body,html{width:100%;height:100%;background:#000;overflow:hidden;color:#fff;}

#loader{
position:fixed;top:0;left:0;width:100%;height:100%;
background:#111;display:flex;align-items:center;justify-content:center;
flex-direction:column;z-index:100;
}
#loader span{
width:12px;height:12px;margin:5px;background:#e50914;border-radius:50%;
display:inline-block;animation:dot 1s infinite;
}
#loader span:nth-child(2){animation-delay:.2s;}
#loader span:nth-child(3){animation-delay:.4s;}
@keyframes dot{0%,80%,100%{transform:scale(0);}40%{transform:scale(1);}}

#nameInputModal{
position:fixed;top:0;left:0;width:100%;height:100%;
background:rgba(0,0,0,0.9);
display:flex;align-items:center;justify-content:center;
flex-direction:column;z-index:101;
}
#nameInputModal input{
padding:12px;font-size:16px;border-radius:8px;border:none;margin:10px;
}
#nameInputModal button{
padding:10px 20px;background:#e50914;color:#fff;border:none;border-radius:8px;
}

#home{width:100%;height:100%;overflow-y:auto;}
#videoList{list-style:none;padding:20px;}
#videoList li{
padding:12px;margin-bottom:10px;background:rgba(255,255,255,0.05);
border-radius:6px;cursor:pointer;
}
.viewedDate{font-size:12px;color:#aaa;margin-top:4px;}

#videoWrapper{width:100vw;height:100vh;position:relative;display:none;}
#player{position:absolute;width:100%;height:100%;pointer-events:none;}

.centralUI{
position:absolute;top:50%;left:50%;
transform:translate(-50%,-50%);
display:flex;gap:20px;z-index:50;
}
.centralUI button{
font-size:22px;padding:14px;
background:rgba(180,180,180,.6);
border:none;color:#fff;border-radius:6px;
}

#resumeInline{
position:absolute;
top:60%;
left:50%;
transform:translateX(-50%);
display:none;
background:rgba(0,0,0,.9);
padding:12px 20px;
border-radius:8px;
z-index:60;
text-align:center;
}

#skipIntro{
position:absolute;right:20px;bottom:100px;
background:rgba(0,0,0,.9);
padding:8px 14px;border-radius:4px;
display:none;z-index:55;
}

#bottomControls{
position:absolute;bottom:0;width:100%;
background:rgba(0,0,0,.6);
display:flex;align-items:center;
padding:8px;gap:8px;z-index:40;
}
#progress{flex:1;}

#chapterBtn{
position:absolute;
top:20px;
right:20px;
z-index:70;
background:#e50914;
color:#fff;
border:none;
padding:8px 12px;
border-radius:6px;
}

#chapterPanel{
position:absolute;
top:0;
right:-320px;
width:320px;
height:100%;
background:rgba(0,0,0,0.95);
overflow-y:auto;
padding:20px;
transition:0.3s;
z-index:65;
}

#chapterPanel p{
margin:8px 0;
cursor:pointer;
}

#chapterPanel .groupTitle{
margin-top:15px;
font-weight:bold;
color:#e50914;
}
</style>
</head>
<body>

<div id="loader">
<div>ロード中…</div>
<div><span></span><span></span><span></span></div>
</div>

<div id="nameInputModal">
<div>名前を入力してください</div>
<input id="usernameInput">
<button onclick="setUsername()">開始</button>
</div>

<div id="home">
<h2 style="padding:20px;color:#e50914;">動画リスト</h2>
<ul id="videoList">
<li onclick="playVideo('FARzkNhit5Q')" id="video_FARzkNhit5Q">
第一回オンライン勉強会ノロウイルスの対応について
<div class="viewedDate"></div>
</li>
</ul>
</div>

<div id="videoWrapper">
<div id="player"></div>

<div class="centralUI" id="centralUI">
<button onclick="rewind10()">«10</button>
<button id="playBtn" onclick="togglePlay()">▶</button>
<button onclick="forward10()">»10</button>
</div>

<div id="resumeInline">
<div style="margin-bottom:8px;">前回の続きから再生しますか？</div>
<button onclick="resumeFrom()">続きから見る</button>
<button onclick="startFromBeginning()" style="margin-left:10px;">初めから見る</button>
</div>

<div id="skipIntro" onclick="skipIntro()">イントロをスキップ</div>

<div id="bottomControls">
<span id="currentTime">0:00</span>
<input type="range" id="progress" min="0" max="100" value="0">
<span id="duration">0:00</span>
</div>

<button id="chapterBtn" onclick="toggleChapters()">チャプター</button>

<div id="chapterPanel">
  <div class="groupTitle">本章</div>
  <p onclick="goTo(0)">オープニング</p>
  <p onclick="goTo(37)">はじめに・導入</p>
  <p onclick="goTo(166)">ノロウイルスの基本知識</p>
  <p onclick="goTo(312)">ノロウイルス感染予防策</p>
  <p onclick="goTo(434)">次亜塩素酸ナトリウム調製</p>

  <div class="groupTitle">実践動画</div>
  <p onclick="goTo(534)">次亜塩素酸ナトリウム調製（実践動画）</p>
  <p onclick="goTo(680)">物品確認編</p>
  <p onclick="goTo(781)">吐物回収編</p>

  <div class="groupTitle">ポイント確認</div>
  <p onclick="goTo(129)">第1章</p>
  <p onclick="goTo(270)">第2章</p>
  <p onclick="goTo(388)">第3章</p>
  <p onclick="goTo(588)">第4章</p>
  <p onclick="goTo(938)">第5章</p>
</div>
</div>

<script src="https://www.youtube.com/iframe_api"></script>
<script>
let player;
let username="guest";
let currentVideoId="";
let resumeTime=0;
let resumePromptShown=false;
let introShown=false;
let introCompleted=false;

function setUsername(){
username=document.getElementById("usernameInput").value.trim();
if(!username)return;
document.getElementById("nameInputModal").style.display="none";
document.getElementById("loader").style.display="none";
updateViewedDates();
}

function playVideo(id){
currentVideoId=id;
resumeTime=parseFloat(localStorage.getItem(username+"_"+id))||0;
resumePromptShown=false;
introShown=false;
introCompleted=false;

document.getElementById("home").style.display="none";
document.getElementById("videoWrapper").style.display="block";

player=new YT.Player('player',{
videoId:id,
playerVars:{controls:0,rel:0,modestbranding:1,fs:0,playsinline:1},
events:{onReady:init}
});
}

function init(){setInterval(updateUI,500);}

function togglePlay(){
if(!resumePromptShown && resumeTime>5){
document.getElementById("resumeInline").style.display="block";
resumePromptShown=true;
setTimeout(()=>{document.getElementById("resumeInline").style.display="none";},5000);
return;
}
let state=player.getPlayerState();
if(state===1){player.pauseVideo();playBtn.innerText="▶";}
else{player.playVideo();playBtn.innerText="❚❚";}
}

function resumeFrom(){
player.seekTo(resumeTime,true);
player.playVideo();
resumeInline.style.display="none";
}

function startFromBeginning(){
localStorage.removeItem(username+"_"+currentVideoId);
player.seekTo(0,true);
player.playVideo();
resumeInline.style.display="none";
}

function updateUI(){
if(!player.getDuration())return;
let c=player.getCurrentTime();
let d=player.getDuration();

currentTime.innerText=formatTime(c);
duration.innerText=formatTime(d);
progress.value=c/d*100;

localStorage.setItem(username+"_"+currentVideoId,c);
localStorage.setItem(username+"_date_"+currentVideoId,new Date().toLocaleDateString());

if(!introCompleted && !introShown && c>=10){
introShown=true;
skipIntro.style.display="block";
setTimeout(()=>{skipIntro.style.display="none";introCompleted=true;},5000);
}
if(c<8){introShown=false;introCompleted=false;}
}

function rewind10(){player.seekTo(player.getCurrentTime()-10,true);}
function forward10(){player.seekTo(player.getCurrentTime()+10,true);}
function skipIntro(){player.seekTo(36,true);skipIntro.style.display="none";introCompleted=true;}

progress.addEventListener("input",e=>{
player.seekTo(e.target.value/100*player.getDuration(),true);
});

function formatTime(t){
let m=Math.floor(t/60);
let s=Math.floor(t%60);
if(s<10)s="0"+s;
return m+":"+s;
}

function updateViewedDates(){
const id="FARzkNhit5Q";
const date=localStorage.getItem(username+"_date_"+id);
if(date){
document.querySelector("#video_"+id+" .viewedDate").innerText="視聴済み："+date;
}
}

function goTo(seconds){player.seekTo(seconds,true);}

function toggleChapters(){
if(chapterPanel.style.right==="0px"){
chapterPanel.style.right="-320px";
}else{
chapterPanel.style.right="0px";
}
}
</script>
</body>
</html>
