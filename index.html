<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>動画アプリ</title>

<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:sans-serif}
body,html{background:#000;color:#fff;width:100%;height:100%}

/* ロード */
#loader{
position:fixed;bottom:0;width:100%;height:80px;
background:#111;display:flex;flex-direction:column;
align-items:center;justify-content:center;
z-index:100;color:#e50914;font-size:20px
}

/* 名前入力 */
#nameModal{
position:fixed;top:0;left:0;width:100%;height:100%;
background:rgba(0,0,0,.9);
display:flex;flex-direction:column;
align-items:center;justify-content:center;
z-index:101;text-align:center
}
#nameModal input{
padding:12px;margin:10px 0;font-size:18px;border:none;border-radius:6px
}
#nameModal button{
padding:10px 20px;background:#e50914;color:#fff;border:none;border-radius:6px
}

/* ホーム */
#home{padding:20px}
#home h2{color:#e50914;margin-bottom:20px}
#home li{
list-style:none;margin-bottom:10px;
background:rgba(255,255,255,.1);
padding:12px;border-radius:6px;cursor:pointer
}

/* 動画 */
#videoWrapper{
display:none;position:relative;width:100%;height:100vh;background:#000
}
#player{
position:absolute;top:0;left:0;width:100%;height:100%;
pointer-events:none
}

/* 中央UI */
.centralUI{
position:absolute;top:50%;left:50%;
transform:translate(-50%,-50%);
display:flex;gap:20px;z-index:50
}
.centralUI button{
background:rgba(192,192,192,.8);
color:#fff;font-weight:bold;border:none;
padding:14px 18px;border-radius:6px;font-size:22px
}

/* イントロ */
#skipIntro{
position:absolute;right:15px;bottom:85px;
background:rgba(192,192,192,.9);
padding:10px 16px;border-radius:6px;
display:none;z-index:55;font-weight:bold
}
#skipBar{height:3px;background:red;width:0;margin-top:4px}

/* 下バー */
#bottomControls{
position:absolute;bottom:0;width:100%;
background:rgba(0,0,0,.7);
display:flex;align-items:center;
padding:8px;gap:10px;z-index:60
}
#progress{flex:1}
#fullscreenBtn{
background:rgba(192,192,192,.8);
border:none;color:#fff;font-size:18px;
padding:6px 10px;border-radius:6px
}

/* resume */
.resumeBox{
position:absolute;bottom:70px;left:50%;
transform:translateX(-50%);
display:flex;gap:10px;z-index:70
}
.resumeBox button{
background:rgba(192,192,192,.9);
color:#fff;font-weight:bold;border:none;
padding:10px 16px;border-radius:6px
}

/* チャプター */
#chapterBtn{
position:absolute;top:15px;right:15px;
z-index:70;background:rgba(0,0,0,.6);
color:#fff;border:none;padding:8px 12px
}
#chapterPanel{
position:fixed;top:0;right:-300px;width:280px;
height:100%;background:rgba(0,0,0,.95);
transition:.3s;padding:20px;z-index:80;
overflow:auto
}
#chapterPanel.open{right:0}
#chapterPanel p{margin:8px 0;cursor:pointer}
</style>
</head>

<body>

<div id="loader">ロード中…</div>

<div id="nameModal">
<div>名前を入力してください<br>例：洞爺 太郎</div>
<input id="usernameInput">
<button onclick="setUsername()">開始</button>
</div>

<div id="home">
<h2>動画リスト</h2>
<li onclick="loadVideo()">第一回オンライン勉強会</li>
</div>

<div id="videoWrapper">
<div id="player"></div>

<button id="chapterBtn" onclick="toggleChapter()">チャプター</button>

<div class="centralUI">
<button onclick="rewind10()">«10</button>
<button onclick="togglePlay()">▶</button>
<button onclick="forward10()">»10</button>
</div>

<div id="skipIntro" onclick="skipIntro()">
イントロをスキップ
<div id="skipBar"></div>
</div>

<div id="bottomControls">
<span id="currentTime">0:00</span>
<input type="range" id="progress" min="0" max="100">
<span id="duration">0:00</span>
<select onchange="changeSpeed(this.value)">
<option value="1">1x</option>
<option value="1.5">1.5x</option>
<option value="2">2x</option>
</select>
<button id="fullscreenBtn" onclick="goFullScreen()">⛶</button>
</div>
</div>

<!-- Chapters -->
<div id="chapterPanel">
<div class="groupTitle">本章</div>
<p onclick="goTo(0)">オープニング</p>
<p onclick="goTo(37)">はじめに・導入</p>
<p onclick="goTo(166)">ノロウイルスの基本知識</p>
<p onclick="goTo(312)">ノロウイルス感染予防策</p>
<p onclick="goTo(434)">次亜塩素酸ナトリウム調製</p>

<div class="groupTitle">実践動画</div>
<p onclick="goTo(534)">次亜塩素酸ナトリウム調製（実践動画）</p>
<p onclick="goTo(680)">物品確認編</p>
<p onclick="goTo(781)">吐物回収編</p>

<div class="groupTitle">ポイント確認</div>
<p onclick="goTo(129)">第1章</p>
<p onclick="goTo(270)">第2章</p>
<p onclick="goTo(388)">第3章</p>
<p onclick="goTo(588)">第4章</p>
<p onclick="goTo(938)">第5章</p>
</div>


<script src="https://www.youtube.com/iframe_api"></script>
<script>
let player,username="",lastTime=0,introShown=false,introTimer;

function setUsername(){
username=document.getElementById("usernameInput").value;
if(!username)return alert("名前入力");
document.getElementById("nameModal").style.display="none";
document.getElementById("loader").style.display="none";
}

function loadVideo(){
document.getElementById("home").style.display="none";
document.getElementById("videoWrapper").style.display="block";

lastTime=parseFloat(localStorage.getItem(username))||0;

player=new YT.Player('player',{
videoId:'FARzkNhit5Q',
playerVars:{controls:0,playsinline:1},
events:{onReady:init}
});
}

function init(){
setInterval(updateUI,500);
if(lastTime>0){
player.playVideo();
showResume();
}
}

function showResume(){
const box=document.createElement("div");
box.className="resumeBox";
const b1=document.createElement("button");
b1.innerText="初めから見る";
b1.onclick=function(){box.remove();}
const b2=document.createElement("button");
b2.innerText="続きから見る";
b2.onclick=function(){
player.seekTo(lastTime,true);
box.remove();
}
box.appendChild(b1);
box.appendChild(b2);
document.getElementById("videoWrapper").appendChild(box);
}

function updateUI(){
if(!player.getDuration())return;
let c=player.getCurrentTime();
let d=player.getDuration();
document.getElementById("currentTime").innerText=format(c);
document.getElementById("duration").innerText=format(d);
document.getElementById("progress").value=c/d*100;
localStorage.setItem(username,c);

if(c>36){introShown=false;skipIntroHide();return;}
if(Math.floor(c)===10 && !introShown){
introShown=true;
let skip=document.getElementById("skipIntro");
let bar=document.getElementById("skipBar");
skip.style.display="block";
bar.style.width="0%";
let w=0;
introTimer=setInterval(()=>{
w+=2;bar.style.width=w+"%";
if(w>=100){clearInterval(introTimer);skip.style.display="none";}
},100);
}
if(c<10)introShown=false;
}

function skipIntroHide(){document.getElementById("skipIntro").style.display="none"}
function togglePlay(){player.getPlayerState()===1?player.pauseVideo():player.playVideo()}
function rewind10(){player.seekTo(player.getCurrentTime()-10,true)}
function forward10(){player.seekTo(player.getCurrentTime()+10,true)}
function skipIntro(){player.seekTo(36,true)}
function changeSpeed(r){player.setPlaybackRate(parseFloat(r))}
function goTo(t){player.seekTo(t,true);toggleChapter()}
function toggleChapter(){document.getElementById("chapterPanel").classList.toggle("open")}
function goFullScreen(){
let el=document.getElementById("videoWrapper");
if(el.requestFullscreen)el.requestFullscreen();
}
function format(t){let m=Math.floor(t/60);let s=Math.floor(t%60);if(s<10)s="0"+s;return m+":"+s}
</script>

</body>
</html>

