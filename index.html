<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#000000">
<meta name="apple-mobile-web-app-capable" content="yes">

<style>
*{box-sizing:border-box}
body{margin:0;background:#000;color:#fff;font-family:sans-serif;overflow:hidden}

#videoWrapper{
  position:relative;
  width:100%;
  height:100vh;
  background:#000;
}

#player{
  position:absolute;
  top:0;left:0;
  width:100%;
  height:100%;
  z-index:1;
}

/* YouTubeタップ防止レイヤー */
#ytBlocker{
  position:absolute;
  top:0;left:0;
  width:100%;
  height:100%;
  z-index:2;
}

/* Controls */
#controls{
  position:absolute;
  left:0;
  bottom:0;
  width:100%;
  background:rgba(0,0,0,.7);
  display:flex;
  align-items:center;
  gap:10px;
  padding:10px;
  z-index:10;
}

button{
  background:rgba(255,255,255,.15);
  border:1px solid #fff;
  color:#fff;
  padding:6px 12px;
}

#progress{flex:1}

/* Intro Skip */
#skipIntro{
  position:absolute;
  right:40px;
  bottom:110px;
  background:rgba(0,0,0,.9);
  padding:14px 22px;
  display:none;
  z-index:15;
}

/* Chapter */
#chapterBtn{
  position:fixed;
  top:20px;
  right:20px;
  background:rgba(0,0,0,.6);
  padding:8px 14px;
  z-index:30;
}

#chapterPanel{
  position:fixed;
  top:0;
  right:0;
  height:100vh;
  width:320px;
  background:rgba(0,0,0,.95);
  transform:translateX(100%);
  transition:.3s;
  overflow-y:auto;
  padding:20px;
  z-index:40;
}

#chapterPanel.open{
  transform:translateX(0);
}

.groupTitle{
  margin:18px 0 8px;
  font-weight:bold;
  color:#e50914;
}

#chapterPanel p{
  margin:6px 0;
  padding:6px 0;
  cursor:pointer;
  border-bottom:1px solid rgba(255,255,255,.15);
}
</style>
</head>

<body>

<div id="videoWrapper">
  <div id="player"></div>
  <div id="ytBlocker" onclick="togglePlay()"></div>

  <div id="skipIntro" onclick="skipIntro()">イントロをスキップ</div>

  <button id="chapterBtn" onclick="toggleChapters()">チャプター</button>

  <div id="controls">
    <button onclick="togglePlay()">▶ / ❚❚</button>
    <span id="currentTime">0:00</span>
    <input type="range" id="progress" value="0" min="0" max="100">
    <span id="duration">0:00</span>
  </div>

  <div id="chapterPanel">
    <div class="groupTitle">各章</div>
    <p onclick="goTo(0)">オープニング</p>
    <p onclick="goTo(166)">ノロウイルスの基本知識</p>
    <p onclick="goTo(312)">感染予防策</p>
    <p onclick="goTo(635)">吐物処理手順</p>
  </div>
</div>

<script src="https://www.youtube.com/iframe_api"></script>
<script>
let player;
let progress=document.getElementById("progress");

function onYouTubeIframeAPIReady(){
  player=new YT.Player('player',{
    videoId:'FARzkNhit5Q',
    playerVars:{
      controls:0,
      rel:0,
      modestbranding:1,
      fs:0,
      playsinline:1,
      disablekb:1
    },
    events:{
      'onReady':init
    }
  });
}

function init(){
  setInterval(updateUI,500);
}

function updateUI(){
  if(!player.getDuration) return;
  let current=player.getCurrentTime();
  let duration=player.getDuration();
  document.getElementById("currentTime").innerText=formatTime(current);
  document.getElementById("duration").innerText=formatTime(duration);
  progress.value=(current/duration)*100;

  if(current>10 && current<36){
    document.getElementById("skipIntro").style.display="block";
  }else{
    document.getElementById("skipIntro").style.display="none";
  }
}

function safeSeek(time){
  player.seekTo(time,true);
  setTimeout(()=>{ player.playVideo(); },200);
}

function skipIntro(){
  safeSeek(36);
}

function goTo(time){
  safeSeek(time);
  toggleChapters();
}

progress.addEventListener("input",function(){
  let duration=player.getDuration();
  safeSeek((progress.value/100)*duration);
});

function togglePlay(){
  let state=player.getPlayerState();
  if(state===1) player.pauseVideo();
  else player.playVideo();
}

function toggleChapters(){
  document.getElementById("chapterPanel").classList.toggle("open");
}

/* 右スワイプで閉じる */
let startX=0;
let panel=document.getElementById("chapterPanel");

panel.addEventListener("touchstart",function(e){
  startX=e.touches[0].clientX;
});

panel.addEventListener("touchmove",function(e){
  let diff=e.touches[0].clientX-startX;
  if(diff>80){
    panel.classList.remove("open");
  }
});

function formatTime(t){
  let m=Math.floor(t/60);
  let s=Math.floor(t%60);
  if(s<10) s="0"+s;
  return m+":"+s;
}
</script>

</body>
</html>
