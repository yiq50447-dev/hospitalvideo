<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<title>動画アプリ</title>
<style>
*{box-sizing:border-box;margin:0;padding:0;font-family:sans-serif;}
body,html{width:100%;height:100%;background:#000;overflow:hidden;color:#fff;}

/* ロード */
#loader{
position:fixed;top:0;left:0;width:100%;height:100%;background:#111;
display:flex;align-items:center;justify-content:center;flex-direction:column;z-index:100;
}
#loader span{
display:inline-block;width:12px;height:12px;margin:5px;background:#e50914;border-radius:50%;
animation:dot 1s infinite;
}
#loader span:nth-child(2){animation-delay:0.2s;}
#loader span:nth-child(3){animation-delay:0.4s;}
@keyframes dot{0%,80%,100%{transform:scale(0);}40%{transform:scale(1);}}

/* 名前 */
#nameInputModal{
position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.85);
display:flex;align-items:center;justify-content:center;flex-direction:column;z-index:101;
padding:20px;text-align:center;
}
#nameInputModal input{
padding:12px 20px;font-size:18px;border:none;border-radius:8px;margin:12px;width:220px;
}
#nameInputModal button{
padding:10px 20px;font-size:18px;border:none;border-radius:8px;background:#e50914;color:#fff;
}

/* リスト */
#home{width:100%;height:100%;overflow-y:auto;display:flex;flex-direction:column;background:#000;}
#videoList{list-style:none;margin-top:20px;padding:0 20px;}
#videoList li{
padding:12px 15px;margin-bottom:10px;background:rgba(255,255,255,0.05);
border-radius:6px;cursor:pointer;
}
#videoList li:hover{background:rgba(255,255,255,0.2);}

/* プレイヤー */
#videoWrapper{width:100vw;height:100vh;position:relative;background:#000;display:none;}
#player{position:absolute;top:0;left:0;width:100%;height:100%;z-index:1;pointer-events:none}

/* 中央UI */
.centralUI{
position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);
display:flex;gap:20px;z-index:50;transition:opacity .3s;
}
.centralUI.hide{opacity:0;pointer-events:none;}
.centralUI button{
background:rgba(192,192,192,0.6);
border:1px solid rgba(255,255,255,0.2);
color:#fff;font-weight:bold;
font-size:24px;padding:14px;cursor:pointer;
}

/* Skip */
#skipIntro{
position:absolute;right:12px;bottom:70px;
background:rgba(0,0,0,.85);
padding:8px 14px;border-radius:4px;
display:none;z-index:30;
}
#skipBar{height:3px;background:#ccc;width:0%;margin-top:4px;border-radius:2px;}

/* 下UI */
#bottomControls{
position:absolute;bottom:0;width:100%;
background:rgba(0,0,0,.6);
display:flex;align-items:center;gap:10px;
padding:8px 12px;z-index:40;transition:opacity .3s;
}
#bottomControls.hide{opacity:0;pointer-events:none;}
#progress{flex:1}

/* チャプター */
#chapterBtn{position:fixed;top:20px;right:20px;z-index:41}
#chapterPanel{
position:fixed;top:0;right:0;width:300px;height:100vh;
background:rgba(0,0,0,.7);backdrop-filter:blur(5px);
transform:translateX(100%);transition:.3s;overflow-y:auto;padding:20px;z-index:42;
}
#chapterPanel.open{transform:translateX(0)}
.groupTitle{margin:20px 0 10px;color:#e50914;font-weight:bold}
#chapterPanel p{margin:6px 0;padding:6px 0;border-bottom:1px solid rgba(255,255,255,.2);cursor:pointer}

/* Resume Box */
#resumeBox{
position:absolute;
top:50%;left:50%;
transform:translate(-50%,-50%);
background:rgba(0,0,0,0.9);
padding:20px;border-radius:8px;
z-index:60;display:none;text-align:center;
}
#resumeBox button{
margin:5px;padding:8px 14px;
}
</style>
</head>
<body>

<div id="loader">
<div style="margin-bottom:15px;">ロード中…</div>
<div><span></span><span></span><span></span></div>
</div>

<div id="nameInputModal">
<div>名前を入力してください<br>（次回再生時、続きから視聴できます）</div>
<div style="margin-top:5px;font-size:14px;color:#ccc;">例: 洞爺 太郎</div>
<input type="text" id="usernameInput">
<button onclick="setUsername()">開始</button>
</div>

<div id="home">
<h2 style="padding:20px;color:#e50914;">動画リスト</h2>
<ul id="videoList">
<li onclick="playVideo('FARzkNhit5Q')">第一回オンライン勉強会ノロウイルスの対応について</li>
</ul>
</div>

<div id="videoWrapper">
<div id="player"></div>

<div id="resumeBox">
<div id="resumeText" style="margin-bottom:10px;"></div>
<button onclick="resumePlay()">続きから見る</button>
<button onclick="restartPlay()">初めから見る</button>
</div>

<div class="centralUI" id="centralUI">
<button onclick="rewind10()">«10</button>
<button id="playBtn" onclick="togglePlay()">▶</button>
<button onclick="forward10()">»10</button>
</div>

<div id="skipIntro" onclick="skipIntro()">イントロをスキップ
<div id="skipBar"></div>
</div>

<div id="bottomControls">
<span id="currentTime">0:00</span>
<input type="range" id="progress" min="0" max="100" value="0">
<span id="duration">0:00</span>
</div>

<button id="chapterBtn" onclick="toggleChapters()">チャプター</button>

<!-- Chapters -->
<div id="chapterPanel">
<div class="groupTitle">本章</div>
<p onclick="goTo(0)">オープニング</p>
<p onclick="goTo(37)">はじめに・導入</p>
<p onclick="goTo(166)">ノロウイルスの基本知識</p>
<p onclick="goTo(312)">ノロウイルス感染予防策</p>
<p onclick="goTo(434)">次亜塩素酸ナトリウム調製</p>

<div class="groupTitle">実践動画</div>
<p onclick="goTo(534)">次亜塩素酸ナトリウム調製（実践動画）</p>
<p onclick="goTo(680)">物品確認編</p>
<p onclick="goTo(781)">吐物回収編</p>

<div class="groupTitle">ポイント確認</div>
<p onclick="goTo(129)">第1章</p>
<p onclick="goTo(270)">第2章</p>
<p onclick="goTo(388)">第3章</p>
<p onclick="goTo(588)">第4章</p>
<p onclick="goTo(938)">第5章</p>
</div>


</div>

<script src="https://www.youtube.com/iframe_api"></script>
<script>
let player,username="guest",lastTime=0,skipTimer;
const progress=document.getElementById("progress");
const centralUI=document.getElementById("centralUI");
const bottomControls=document.getElementById("bottomControls");
const chapterPanel=document.getElementById("chapterPanel");

function setUsername(){
let input=document.getElementById("usernameInput").value.trim();
if(input===""){alert("名前を入力してください");return;}
username=input;
lastTime=parseFloat(localStorage.getItem(username))||0;
document.getElementById("nameInputModal").style.display="none";
document.getElementById("loader").style.display="none";
}

function playVideo(videoId){
document.getElementById("home").style.display="none";
document.getElementById("videoWrapper").style.display="block";

player=new YT.Player('player',{
videoId:videoId,
playerVars:{controls:0,rel:0,playsinline:1},
events:{
'onReady':()=>{
init();
if(lastTime>5){
showResumeBox();
player.pauseVideo();
}
},
'onStateChange':function(e){
if(e.data===YT.PlayerState.ENDED){
localStorage.setItem(username,0);
lastTime=0;
}
}
}
});
}

function init(){setInterval(updateUI,500);}

function updateUI(){
if(!player.getDuration())return;
let c=player.getCurrentTime();
let d=player.getDuration();
document.getElementById("currentTime").innerText=formatTime(c);
document.getElementById("duration").innerText=formatTime(d);
progress.value=(c/d*100);
localStorage.setItem(username,c);

if(c>10 && c<36){
let skip=document.getElementById("skipIntro");
skip.style.display="block";
}else{
document.getElementById("skipIntro").style.display="none";
}
}

progress.addEventListener("input",()=>{
player.seekTo(progress.value/100*player.getDuration(),true);
});

function togglePlay(){
let btn=document.getElementById("playBtn");
if(player.getPlayerState()===1){player.pauseVideo();btn.innerText="▶";}
else{player.playVideo();btn.innerText="❚❚";}
}

function rewind10(){player.seekTo(player.getCurrentTime()-10,true);}
function forward10(){player.seekTo(player.getCurrentTime()+10,true);}
function skipIntro(){player.seekTo(36,true);}

function toggleChapters(){chapterPanel.classList.toggle("open");}

function goTo(t){player.seekTo(t,true);toggleChapters();}

function showResumeBox(){
let box=document.getElementById("resumeBox");
let m=Math.floor(lastTime/60);
let s=Math.floor(lastTime%60);
if(s<10)s="0"+s;
document.getElementById("resumeText").innerText=m+":"+s+" から再生しますか？";
box.style.display="block";
}

function resumePlay(){
document.getElementById("resumeBox").style.display="none";
player.seekTo(lastTime,true);
player.playVideo();
}

function restartPlay(){
document.getElementById("resumeBox").style.display="none";
lastTime=0;
localStorage.setItem(username,0);
player.seekTo(0,true);
player.playVideo();
}

function formatTime(t){
let m=Math.floor(t/60);
let s=Math.floor(t%60);
if(s<10)s="0"+s;
return m+":"+s;
}
</script>
</body>
</html>
