<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<title>動画アプリ</title>

<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:sans-serif}
body,html{width:100%;height:100%;background:#000;color:#fff;overflow:hidden}

/* ロード 下固定 */
#loader{
position:fixed;
bottom:0;
left:0;
width:100%;
height:90px;
background:#111;
display:flex;
flex-direction:column;
align-items:center;
justify-content:center;
z-index:100;
font-size:22px;
color:#e50914;
}
#loader span{
width:12px;height:12px;background:#e50914;border-radius:50%;margin:4px;
display:inline-block;animation:bounce 1s infinite;
}
#loader span:nth-child(2){animation-delay:.2s}
#loader span:nth-child(3){animation-delay:.4s}
@keyframes bounce{
0%,80%,100%{transform:scale(0)}
40%{transform:scale(1)}
}

/* 名前入力 */
#nameModal{
position:fixed;top:0;left:0;width:100%;height:100%;
background:rgba(0,0,0,.9);
display:flex;flex-direction:column;align-items:center;justify-content:center;
z-index:101;text-align:center;padding:20px
}
#nameModal input{
padding:12px;font-size:18px;border:none;border-radius:6px;margin:12px 0;width:220px
}
#nameModal button{
padding:10px 20px;background:#e50914;color:#fff;border:none;border-radius:6px;font-size:18px
}

/* ホーム */
#home{width:100%;height:100%;overflow:auto;padding:20px}
#home h2{color:#e50914;margin-bottom:20px}
#home li{list-style:none;margin-bottom:10px;background:rgba(255,255,255,.1);padding:12px;border-radius:6px;cursor:pointer}

/* 動画 */
#videoWrapper{position:relative;width:100vw;height:100vh;display:none;background:#000}
#player{position:absolute;top:0;left:0;width:100%;height:100%;pointer-events:none}

/* 中央UI */
.centralUI{
position:absolute;top:50%;left:50%;
transform:translate(-50%,-50%);
display:flex;gap:20px;
z-index:50;transition:.3s
}
.centralUI.hide{opacity:0;pointer-events:none}
.centralUI button{
background:rgba(192,192,192,.75);
color:#fff;font-weight:bold;
border:none;border-radius:4px;
padding:14px 18px;font-size:22px
}

/* イントロ */
#skipIntro{
position:absolute;
right:20px;
bottom:90px;
background:rgba(192,192,192,.8);
color:#fff;font-weight:bold;
padding:10px 16px;
border-radius:4px;
display:none;
z-index:40
}
#skipBar{
height:3px;background:red;width:0;margin-top:4px
}

/* 下コントロール */
#bottomControls{
position:absolute;bottom:0;width:100%;
background:rgba(0,0,0,.6);
display:flex;align-items:center;gap:10px;
padding:8px 10px;z-index:45;transition:.3s
}
#bottomControls.hide{opacity:0;pointer-events:none}
#progress{flex:1}

/* resume */
.resumeBox{
position:absolute;bottom:70px;left:50%;
transform:translateX(-50%);
display:flex;gap:12px;z-index:60
}
.resumeBox button{
background:rgba(192,192,192,.8);
color:#fff;font-weight:bold;
border:none;border-radius:4px;
padding:10px 16px
}
</style>
</head>

<body>

<div id="loader">
ロード中…
<div>
<span></span><span></span><span></span>
</div>
</div>

<div id="nameModal">
<div>名前を入力してください<br>
次回から続きから再生できます</div>
<div style="font-size:14px;color:#aaa">例：洞爺 太郎</div>
<input id="usernameInput" placeholder="例：洞爺 太郎">
<button onclick="setUsername()">開始</button>
</div>

<div id="home">
<h2>動画リスト</h2>
<li onclick="startVideo()">第一回オンライン勉強会</li>
</div>

<div id="videoWrapper">
<div id="player"></div>

<div class="centralUI" id="centralUI">
<button onclick="rewind10()">«10</button>
<button onclick="togglePlay()">▶</button>
<button onclick="forward10()">»10</button>
</div>

<div id="skipIntro" onclick="skipIntro()">
イントロをスキップ
<div id="skipBar"></div>
</div>

<div id="bottomControls">
<span id="currentTime">0:00</span>
<input type="range" id="progress" min="0" max="100" value="0">
<span id="duration">0:00</span>
<select onchange="changeSpeed(this.value)">
<option value="1">1x</option>
<option value="1.25">1.25x</option>
<option value="1.5">1.5x</option>
<option value="2">2x</option>
</select>
<button onclick="goFullScreen()">⛶</button>
</div>
</div>

<script src="https://www.youtube.com/iframe_api"></script>
<script>

let player;
let username="";
let lastTime=0;
let introShown=false;
let introTimer=null;
let uiTimer;

function setUsername(){
username=document.getElementById("usernameInput").value.trim();
if(!username)return alert("名前を入力してください");
lastTime=parseFloat(localStorage.getItem(username))||0;
document.getElementById("nameModal").style.display="none";
document.getElementById("loader").style.display="none";
}

function startVideo(){
document.getElementById("home").style.display="none";
document.getElementById("videoWrapper").style.display="block";

player=new YT.Player('player',{
videoId:'FARzkNhit5Q',
playerVars:{controls:0,rel:0,playsinline:1},
events:{onReady:init}
});
}

function init(){
setInterval(updateUI,500);
if(lastTime>0) showResume();
showUI();
}

function showResume(){
const box=document.createElement("div");
box.className="resumeBox";

const b1=document.createElement("button");
b1.innerText="初めから見る";
b1.onclick=function(){box.remove();}

const b2=document.createElement("button");
b2.innerText="続きから見る";
b2.onclick=function(){
player.seekTo(lastTime,true);
box.remove();
}

box.appendChild(b1);
box.appendChild(b2);
document.getElementById("videoWrapper").appendChild(box);
}

function updateUI(){
if(!player.getDuration())return;

let c=player.getCurrentTime();
let d=player.getDuration();

document.getElementById("currentTime").innerText=format(c);
document.getElementById("duration").innerText=format(d);
document.getElementById("progress").value=c/d*100;
localStorage.setItem(username,c);

/* イントロロジック */
if(c>36){
introShown=false;
document.getElementById("skipIntro").style.display="none";
return;
}

if(Math.floor(c)===10 && !introShown){
introShown=true;
let skip=document.getElementById("skipIntro");
let bar=document.getElementById("skipBar");
skip.style.display="block";
bar.style.width="0%";
let w=0;
clearInterval(introTimer);
introTimer=setInterval(()=>{
w+=2;
bar.style.width=w+"%";
if(w>=100){
clearInterval(introTimer);
skip.style.display="none";
}
},100);
}

if(c<10){
introShown=false;
}
}

function togglePlay(){
let s=player.getPlayerState();
if(s===1)player.pauseVideo();
else player.playVideo();
}
function rewind10(){player.seekTo(player.getCurrentTime()-10,true)}
function forward10(){player.seekTo(player.getCurrentTime()+10,true)}
function skipIntro(){player.seekTo(36,true)}
function changeSpeed(r){player.setPlaybackRate(parseFloat(r))}

document.getElementById("progress").addEventListener("input",e=>{
player.seekTo(e.target.value/100*player.getDuration(),true);
});

function goFullScreen(){
let elem=document.getElementById("videoWrapper");
if(elem.requestFullscreen)elem.requestFullscreen();
if(screen.orientation && screen.orientation.lock){
screen.orientation.lock("landscape").catch(()=>{});
}
}

function showUI(){
document.getElementById("centralUI").classList.remove("hide");
document.getElementById("bottomControls").classList.remove("hide");
clearTimeout(uiTimer);
uiTimer=setTimeout(()=>{
document.getElementById("centralUI").classList.add("hide");
document.getElementById("bottomControls").classList.add("hide");
},3000);
}
document.addEventListener("click",showUI);

function format(t){
let m=Math.floor(t/60);
let s=Math.floor(t%60);
if(s<10)s="0"+s;
return m+":"+s;
}
</script>

</body>
</html>
